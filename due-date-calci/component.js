class PregnancyJourney{constructor({target:e}){if(this.el="string"==typeof e?document.querySelector(e):e,!this.el)throw"Target not found";this.PATH_D="\n      M 50 200\n      C 150 60, 250 340, 350 200\n      C 450 60, 550 340, 650 200\n      C 750 60, 850 340, 950 200\n    ",this.renderShell(),this.bind()}renderShell(){this.el.innerHTML='\n      <div class="pc-app">\n        <div class="pc-card pc-header">\n          <label>\n            Last Menstrual Period\n            <input type="date" id="pcLmp" />\n          </label>\n        </div>\n\n        <div id="pcResult"></div>\n      </div>\n    '}bind(){this.lmpInput=this.el.querySelector("#pcLmp"),this.result=this.el.querySelector("#pcResult"),this.lmpInput.addEventListener("change",(()=>this.update()))}calculate(e){const t=new Date;if(!(e instanceof Date)||isNaN(e))return null;const r=Math.max(0,t-e),s=Math.floor(r/864e5),n=Math.floor(s/7),a=s%7;return{weeks:n,remDays:a,daysPassed:s,daysLeft:Math.max(0,280-s),month:this.getPregnancyMonth(n,a),trimester:this.getTrimester(n),progress:Math.min(n/40,1)}}getTrimester(e){return e<=13?"1st":e<=27?"2nd":"3rd"}getPregnancyMonth(e){return e<=4?1:e<=8?2:e<=13?3:e<=17?4:e<=22?5:e<=27?6:e<=31?7:e<=35?8:9}update(){if(!this.lmpInput.value)return;const e=new Date(this.lmpInput.value),{weeks:t,daysLeft:r,remDays:s,month:n,progress:a}=this.calculate(e),i=this.getTrimester(t),c=this.renderSummaryTable({trimester:i,month:n,weeks:t,daysLeft:r});this.result.innerHTML=`\n      ${c}\n      <section class="pc-journey">\n        <svg viewBox="0 0 1000 300" class="pc-journey-svg">\n          <path d="${this.PATH_D}" class="pc-base-path"/>\n          <path d="${this.PATH_D}" class="pc-progress-path" id="pcProgressPath"/>\n          ${this.weekMarkers()}\n          <g class="pc-baby-marker">\n            <use href="/images/baby-icon.svg" width="34" height="34" class="pc-marker-icon"></use>\n            <text class="pc-marker-label" text-anchor="middle">${t} week(s) ${s} days</text>\n          </g>\n      </section>\n    `,this.positionWeekMarkers(),this.animateProgress(a,n,s)}weekMarkers(){return Array.from({length:40},(()=>'\n    <circle r="3" class="pc-week-marker"></circle>\n  ')).join("")}positionWeekMarkers(){const e=this.result.querySelector("#pcProgressPath"),t=e.getTotalLength();this.result.querySelectorAll(".pc-week-marker").forEach(((r,s)=>{const n=e.getPointAtLength((s+1)/40*t);r.setAttribute("cx",n.x),r.setAttribute("cy",n.y)}))}animateProgress(e,t,r){const s=this.result.querySelector("#pcProgressPath"),n=this.result.querySelector(".pc-baby-marker use"),a=this.result.querySelector(".pc-baby-marker text"),i=s.getTotalLength();const c=performance.now(),o=t=>{const r=t-c,h=Math.min(r/2200,1),l=1-Math.pow(1-h,3),u=0+(e-0)*l;s.style.strokeDasharray=i,s.style.strokeDashoffset=i*(1-u);const d=s.getPointAtLength(u*i);n.setAttribute("x",d.x-17),n.setAttribute("y",d.y-34),a.setAttribute("x",d.x),a.setAttribute("y",d.y-42),h<1&&requestAnimationFrame(o)};requestAnimationFrame(o)}renderSummaryTable({trimester:e,month:t,weeks:r,daysLeft:s}){return`\n    <table class="pc-summary-table">\n      <thead>\n        <tr>\n          <th>Trimester</th>\n          <th>Month</th>\n          <th>Weeks</th>\n          <th>Days Left</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr>\n          <td>${e}</td>\n          <td>${t}</td>\n          <td>${r}</td>\n          <td>${s}</td>\n        </tr>\n      </tbody>\n    </table>\n  `}}document.addEventListener("DOMContentLoaded",(function(){new PregnancyJourney({target:"#due-date-calci"})}));